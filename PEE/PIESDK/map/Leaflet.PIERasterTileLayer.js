"use strict";var e=function(e){function t(t,r,n){e.call(this,t),this.status=r,this.url=n,this.name=this.constructor.name,this.message=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error);function t(e,t){for(var r in t)e[r]=t[r];return e}var r,n,a=function(t,r){return!/^file:/.test(t.url)&&fetch&&Request&&AbortController&&Request.prototype.hasOwnProperty("signal")?function(t,r){var n=new AbortController,a=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,signal:n.signal});return"json"===t.type&&a.headers.set("Accept","application/json"),fetch(a).then((function(n){n.ok?n[t.type||"text"]().then((function(e){r(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires"))})).catch((function(e){return r(new Error(e.message))})):r(new e(n.statusText,n.status,t.url))})).catch((function(e){20!==e.code&&r(new Error(e.message))})),{cancel:function(){return n.abort()}}}(t,r):function(t,r){var n=new XMLHttpRequest;for(var a in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(a,t.headers[a]);return"json"===t.type&&n.setRequestHeader("Accept","application/json"),n.withCredentials="include"===t.credentials,n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var a=n.response;if("json"===t.type)try{a=JSON.parse(n.response)}catch(e){return r(e)}r(null,a,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else r(new e(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,r)},o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";r=[],n=0;var s=function(e,i){if(n>=16){var c={requestParameters:e,callback:i,cancelled:!1,cancel:function(){this.cancelled=!0}};return r.push(c),c}n++;var u=!1,l=function(){if(!u)for(u=!0,n--;r.length&&n<16;){var e=r.shift(),t=e.requestParameters,a=e.callback;e.cancelled||(e.cancel=s(t,a).cancel)}},p=null;return p=e.url.indexOf("earthengine-legacy")>0||e.url.indexOf("gettile")>0?function(e,r){return a(t(e,{type:"json"}),r)}(e,(function(e,t,r,n){if(l(),e)i(e);else if(t){var a=null;a=null!=t.data?new Uint8Array(t.data.data):new Uint8Array;var s=new Image,c=c||webkitURL;s.onload=function(){i(null,s),c.revokeObjectURL(s.src)},s.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported json format."))};var u=new Blob([a],{type:"image/png"});s.cacheControl=r,s.expires=n,s.src=a.buffer.byteLength?c.createObjectURL(u):o}})):function(e,r){return a(t(e,{type:"arrayBuffer"}),r)}(e,(function(e,t,r,n){if(l(),e)i(e);else if(t){var a=new Image,s=s||webkitURL;a.onload=function(){i(null,a),s.revokeObjectURL(a.src)},a.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var c=new Blob([new Uint8Array(t)],{type:"image/png"});a.cacheControl=r,a.expires=n,a.src=t.byteLength?s.createObjectURL(c):o}})),{cancel:function(){p.cancel(),l()}}};L.PIERasterTileLayer=L.TileLayer.extend({initialize:function(e,t){t||(t={}),L.TileLayer.prototype.initialize.call(this,e,t),this.headers=t?t.headers:{}},createTile(e,t){const r=this.getTileUrl(e),n=document.createElement("img");n.setAttribute("role","presentation");var a={headers:this.headers,url:r};return s(a,((e,r)=>{r?(delete r.cacheControl,delete r.expires,n.src=r.src,t(null,n)):t(e)})),n}}),L.pieRasterTileLayer=function(e,t){return new L.PIERasterTileLayer(e,t)};
